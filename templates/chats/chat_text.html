<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chats</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
</head>
<body>
    
    <nav class="navbar bg-body-tertiary fixed-top">
  <div class="container-fluid">
    <a href="{% url 'chats:index' %}" class="badge navbar-brand text-nowrap bg-success border fs-3">Chats</a>
  </div>
</nav>
    
   <div style="text-align:center; margin-top:70px; margin-bottom:20px;">
  <span style="background-color:#f2f2f2; padding:10px 16px; border-radius:20px; display:inline-block;">
    <h1 class="h1 fs-1" style="margin:0;">{{ friend_username }}</h1>
  </span>
</div>
   
   <div id="chat-container" style="padding-bottom: 80px;">
  {% for chat in chats %}
    {% include 'chats/partials/text_partial.html' %}
  {% endfor %}
</div>

<form class="fixed-bottom bg-white p-2 border-top mt-2" id="message-form" data-id={{ friend_id }}>
  {% csrf_token %}
  <div class="container">
    <div class="input-group">
      <input type="text" name="text" class="form-control rounded-pill message-input" id="message-input" placeholder="Type a message..." required>
      <button class="btn btn-success ms-2 rounded-pill" type="submit">Send</button>
    </div>
  </div>
</form>
    
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $('#message-form').on('submit', function(e) {
    e.preventDefault();
    const message = $('#message-input').val();
    const csrfToken = $('input[name="csrfmiddlewaretoken"]').val();
    const friendId = $('#message-form').data('id');

    $.ajax({
      type: 'POST',
      url: "{% url 'chats:send_message' friend_id %}",
      data: {
        'text': message,
        'csrfmiddlewaretoken': csrfToken
      },
      success: function(response) {
        $('#message-input').val('');
        $('#chat-container').append(response.html);
        window.scrollTo(0, document.body.scrollHeight);
      },
      error: function() {
        alert('Message failed to send.');
      }
    });
  });
</script>
</body>
</html>